{"version":3,"sources":["../src/index.jsx"],"names":["JivePlaceSelector","props","value","isArray","length","undefined","state","places","id","multiple","contentType","mainClasses","main","map","item","i","name","subject","remove","e","callPicker","limit","buttonTitle","preventDefault","jive","corev3","search","requestPicker","excludeContent","excludePlaces","excludePeople","success","add","data","error","console","JSON","stringify","place","filterFields","itemExists","findIndex","targetPlace","placeID","contentID","setState","$push","onChange","resources","uri","self","ref","formatted","$splice","output","default"],"mappings":"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","file":"index.js","sourcesContent":["/**\r\n * Created by M. Yegorov on 2016-10-25.\r\n */\r\n\r\nimport React, {Component} from 'react';\r\nimport update from 'react-addons-update';\r\nimport classnames from 'classnames';\r\n\r\nimport osapi from 'jive/osapi';\r\n\r\nimport css from './JiveTilePlacePicker.css'\r\n\r\nexport default class JivePlaceSelector extends Component {\r\n\r\n    constructor(props){\r\n        super(props);\r\n\r\n        const {value} = props;\r\n        const isArray = props.value.length != undefined;\r\n\r\n        this.state = {\r\n            places: props.value ? (isArray ? value : (value.id > 0 ? [value] : [])) : [],\r\n            multiple: isArray,\r\n            contentType: props.contentType || 'place'\r\n        }\r\n    }\r\n\r\n    render() {\r\n\r\n        const {places, multiple, contentType} = this.state;\r\n\r\n        const mainClasses = classnames(css.main, 'anrom-jive-osapi-picker', {\r\n            multiple\r\n        });\r\n\r\n        return <div className={mainClasses}>\r\n            <div className=\"selected-places\">\r\n                {places.map((item, i) =>\r\n                    <div key={i}>\r\n                        <span className=\"selected\">\r\n                            {contentType == 'place' && <span className=\"name\">{item.name}</span>}\r\n                            {contentType == 'people' && <span className=\"name\">{item.name}</span>}\r\n                            {contentType == 'content' && <span className=\"name\">{item.subject}</span>}\r\n                            <a className=\"remove\" onClick={e => this.remove(e, i)}>&times;</a>\r\n                        </span>\r\n                    </div>\r\n                )}\r\n            </div>\r\n\r\n            {(multiple || !places.length) && <button onClick={::this.callPicker} disabled={this.props.limit && places.length >= this.props.limit}>\r\n                {this.props.buttonTitle || 'Add place'}\r\n            </button>}\r\n        </div>\r\n    }\r\n\r\n    callPicker(e) {\r\n        e.preventDefault();\r\n\r\n        const {contentType} = this.state\r\n\r\n        osapi.jive.corev3.search.requestPicker({\r\n            excludeContent: contentType == 'people' || contentType == 'place',\r\n            excludePlaces: contentType == 'people' || contentType == 'content',\r\n            excludePeople: contentType == 'content' || contentType == 'place',\r\n            success: data => this.add(data),\r\n            error: data => {\r\n                console.error('error: ' + JSON.stringify(data));\r\n            }\r\n        });\r\n    }\r\n\r\n    add(place){\r\n        const {contentType} = this.state\r\n\r\n        const filterFields = this.props.filterFields || ::this.filterFields;\r\n\r\n        let itemExists = true\r\n        if (contentType == 'place'){\r\n            itemExists = this.state.places.findIndex(targetPlace => targetPlace.id == place.placeID) != -1;\r\n        }\r\n        if (contentType == 'content'){\r\n            itemExists = this.state.places.findIndex(targetPlace => targetPlace.id == place.contentID) != -1;\r\n        }\r\n        if (contentType == 'people'){\r\n            itemExists = this.state.places.findIndex(targetPlace => targetPlace.id == place.id) != -1;\r\n        }\r\n\r\n        if (!itemExists){\r\n            this.setState(update(this.state, {\r\n                places: {$push: [filterFields(place)]}\r\n            }), () => this.onChange())\r\n        }\r\n    }\r\n    \r\n    filterFields(item){\r\n        const {contentType} = this.state\r\n        const {resources, name, subject, contentID, placeID, id} = item;\r\n\r\n        switch (contentType){\r\n            case 'place':\r\n                return {\r\n                    name,\r\n                    id: placeID,\r\n                    uri: resources.self.ref\r\n                }\r\n            case 'content':\r\n                return {\r\n                    name: subject,\r\n                    id: contentID,\r\n                    uri: resources.self.ref\r\n                }\r\n            case 'people':\r\n                return {\r\n                    name: name.formatted,\r\n                    id,\r\n                    uri: resources.self.ref\r\n                }\r\n        }\r\n    }\r\n\r\n    remove(e, i) {\r\n        e.preventDefault();\r\n\r\n        this.setState(update(this.state, {\r\n            places: {$splice: [[i,1]]}\r\n        }), () => this.onChange())\r\n    }\r\n\r\n    onChange(){\r\n        if (typeof this.props.onChange == 'function'){\r\n\r\n            const {places, multiple} = this.state;\r\n\r\n            let output;\r\n\r\n            if (places.length){\r\n                output = multiple ? places : places[0]\r\n            } else {\r\n                output = multiple ? [] : this.props.default || false\r\n            }\r\n\r\n            this.props.onChange(output)\r\n        }\r\n    }\r\n}"]}